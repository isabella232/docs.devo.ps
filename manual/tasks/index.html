<!doctype html>
<html>
<head>
  <meta charset='utf-8'/>
  <title>Tasks | devo.ps documentation</title>
  <meta name='description' content='Documentation for devo.ps'/>
  <meta name='keywords' content='devo.ps, DevOps, Cloud, servers, infrastructure, automation, Continuous Integration, Continuous Deployment, Configuration Management, Orchestration, System Administration, PaaS, IaaS, documentation'/>
  <meta name='viewport' content='width=device-width, initial-scale=1'/>
  
  <!-- Favicons -->
  <link rel='shortcut icon' href='/assets/favicon.ico'>
<link rel='apple-touch-icon' sizes='57x57' href='/assets/favicons/apple-touch-icon-57x57.png'>
<link rel='apple-touch-icon' sizes='114x114' href='/assets/favicons/apple-touch-icon-114x114.png'>
<link rel='apple-touch-icon' sizes='72x72' href='/assets/favicons/apple-touch-icon-72x72.png'>
<link rel='apple-touch-icon' sizes='144x144' href='/assets/favicons/apple-touch-icon-144x144.png'>
<link rel='apple-touch-icon' sizes='60x60' href='/assets/favicons/apple-touch-icon-60x60.png'>
<link rel='apple-touch-icon' sizes='120x120' href='/assets/favicons/apple-touch-icon-120x120.png'>
<link rel='apple-touch-icon' sizes='76x76' href='/assets/favicons/apple-touch-icon-76x76.png'>
<link rel='apple-touch-icon' sizes='152x152' href='/assets/favicons/apple-touch-icon-152x152.png'>
<link rel='icon' type='image/png' href='/assets/favicons/favicon-196x196.png' sizes='196x196'>
<link rel='icon' type='image/png' href='/assets/favicons/favicon-160x160.png' sizes='160x160'>
<link rel='icon' type='image/png' href='/assets/favicons/favicon-96x96.png' sizes='96x96'>
<link rel='icon' type='image/png' href='/assets/favicons/favicon-16x16.png' sizes='16x16'>
<link rel='icon' type='image/png' href='/assets/favicons/favicon-32x32.png' sizes='32x32'>
<meta name='msapplication-TileColor' content='#da532c'>
<meta name='msapplication-TileImage' content='/assets/favicons/mstile-144x144.png'>
<meta name='msapplication-config' content='/assets/favicons/browserconfig.xml'>

  <!-- CSS -->
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
  <link href='/assets/styles.css' rel='stylesheet' type='text/css'/>
  <link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.0/styles/github.min.css' rel='stylesheet' type='text/css'/>
</head>
<body>
  <header id='header'>
    <div class='content'>
      <nav class='menu'>
        <a href='http://devo.ps/blog'>Blog</a>
        <a href='http://devo.ps/about'>About</a>
        <form>
  <input type='text' id='st-search-input' placeholder='Search by keyword'/>
</form>
<script type='text/javascript'>
var Swiftype = window.Swiftype || {};
  (function() {
    Swiftype.key = 'nkPRs5W_yrQndsebXC-A';

    /** DO NOT EDIT BELOW THIS LINE **/
    var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
    script.src = '//s.swiftypecdn.com/embed.js';
    var entry = document.getElementsByTagName('script')[0];
    entry.parentNode.insertBefore(script, entry);
  }());
</script>
      </nav>

      <a class='logo' href='http://devo.ps'>devo.ps</a> documentation
    </div>
  </header>

  <section id='main'>
    <nav class='sidebar'>
      <a href='/'>Getting started</a>

<!-- <h3>Guides</h3>


  

  


<a href='/guides/how-to-deploy-your-nodejs-app' >undefined</a>

<a href='/guides/how-to-use-the-cli' >Command Line Interface (CLI)</a>
 -->

<h3>Manual</h3>


  

  

  

  

  

  


<a href='/manual/CLI' >CLI</a>

<a href='/manual/git-repositories' >Git &amp; Repositories</a>

<a href='/manual/nodes' >Nodes</a>

<a href='/manual/profile' >Profile</a>

<a href='/manual/tasks'  class='active'>Tasks</a>

<a href='/manual/vars' >Variables</a>


<h3>Providers</h3>


  

  

  

  


<a href='/providers/digital_ocean' >Digital Ocean</a>

<a href='/providers/ec2' >Ec2</a>

<a href='/providers/linode' >Linode</a>

<a href='/providers/rackspace' >Rackspace</a>


<h3>Services</h3>


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  


<a href='/services/apache' >Apache</a>

<a href='/services/common' >Common</a>

<a href='/services/couchbase' >CouchBase</a>

<a href='/services/couchdb' >CouchDB</a>

<a href='/services/dart' >Dart</a>

<a href='/services/docker' >Docker</a>

<a href='/services/elasticsearch' >ElasticSearch</a>

<a href='/services/git' >Git</a>

<a href='/services/go' >Go</a>

<a href='/services/java' >Java</a>

<a href='/services/memcached' >Memcached</a>

<a href='/services/mongodb' >MongoDB</a>

<a href='/services/mysql' >MySQL</a>

<a href='/services/nginx' >Nginx</a>

<a href='/services/nodejs' >Node.js</a>

<a href='/services/openvpn' >OpenVPN</a>

<a href='/services/php' >PHP</a>

<a href='/services/python' >Python</a>

<a href='/services/rabbitmq' >RabbitMQ</a>

<a href='/services/redis' >Redis</a>

<a href='/services/ruby' >Ruby</a>

<a href='/services/uwsgi' >uWSGI</a>

<a href='/services/vagrant' >Vagrant</a>

<a href='/services/varnish' >Varnish</a>

<a href='/services/xvfb' >Xvfb</a>

<a href='/services/zeromq' >ZeroMQ</a>

    </nav>

    <section class='content'>
      

<header class='header'>
  <ul class='tags'>
    
  </ul>

  <h1>Tasks </h1>  
</header>



<section class='body'>
  <p>Tasks are simple sequences of commands performed on designed <a href="/manual/nodes">nodes</a> of a repository upon certain events (aka &quot;triggers&quot;).</p>
<h2 id="task-file">Task file</h2>
<p>As with nodes, you define a task using a simple YAML (<code>.yml</code>) file.</p>
<p><em>We currently require that you name the file as the task id (see example) and save it in the <code>tasks/</code> folder. We are working on adding support for arbitrary file names and folders, allowing you to save multiple tasks in a single file.</em></p>
<p>For example, we could add a <code>deploy.yml</code> file with the following content:</p>
<pre><code>id: deploy
type: task
name: Deployment pipeline

triggers:
  webhooks:
    - deploy

targets:
  - nodejs_server

vars:
  build: /opt/build_temp
  domain: example.com

steps:
  - run: devops git update
    options:
      repo: https://github.com/Wiredcraft/octokan.com.git
      dest: {{ build }}
      version: master
  - run: cd {{ build }}; make build ; cp -a _site/* /var/www/{{ domain }}
</code></pre><h2 id="format">Format</h2>
<dl>
  <dt><code><span class='type'>string</span> id</code></dt>
  <dd>The id of the task, currently has to match the file name.</dd>

  <dt><code><span class='type'>string</span> name</code></dt>
  <dd>The name of the task as displayed in the Web UI and CLI.</dd>

  <dt><code><span class='type'>string</span> type</code></dt>
  <dd>Must be set to <code>task</code>, defines this file as a task.</dd>

  <dt><code><span class='type'>object</span> vars</code> <span class='optional'>Optional</span></dt>
  <dd>Used to define a list of variables local to the task. Useful to define values you want to use in the steps (see belows).</dd>

  <dt><code><span class='type'>object</span> triggers</code> <span class='optional'>Optional</span></dt>
  <dd>A list of events upon which to run the task. Currently only supports manual trigger and webhooks. <a href='#triggers'>Read more about triggers below</a>.</dd>

  <dt><code><span class='type'>object</span> targets</code></dt>
  <dd>A list of nodes id on which to run the task.</dd>

  <dt><code><span class='type'>object</span> steps</code></dt>
  <dd>
    A series of commands and tasks to be run one after the other.
    <dl>
      <dt><code><span class='type'>string</span> run</code></dt>
      <dd>A command to be run; it may be an inline shell command, the path to one of the <a href="/manual/scripts">scripts</a> available in the repository or a <code>devops</code> command. <a href='#steps'>Read more about steps below</a>.</dd>

      <dt><code><span class='type'>object</span> options</code> <span class='optional'>Optional</span></dt>
      <dd>An object of options to be passed to the command if it is a devops command.</dd>

      <dt><code><span class='type'>object</span> targets</code></dt>
      <dd>A list of nodes id on which to run the command. <strong>This takes precedence over the targets defined at the root of the task</strong>.</dd>
    </dl>
  </dd>
</dl>

<h2 id="runs-status">Runs &amp; Status</h2>
<p>Everytime a task is triggered, an instance of that task, called a &quot;run&quot;, is instanciated. Changes happening after a run has started won&#39;t affect it. Each run is asigned a unique id (the &quot;run id&quot;).</p>
<p>A run can be:</p>
<table>
<thead>
<tr>
<th>Status</th>
<th>Description</th>
<th>Icon</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class='icon done'></span></td>
<td><strong>Done</strong></td>
<td>The run completed successfully.</td>
</tr>
<tr>
<td><span class='icon running'></span></td>
<td><strong>Running</strong></td>
<td>The run is currently ongoing.</td>
</tr>
<tr>
<td> <span class='icon error'></span></td>
<td><strong>Failed</strong></td>
<td>The run aborted after running into an error (details about the error can be found in the console).</td>
</tr>
</tbody>
</table>
<h2 id="steps">Steps</h2>
<p>The <code>steps</code> attribute defines the series of commands that composes the task. These commands can be of 3 kinds:</p>
<ul>
<li><p><strong>Inline command</strong>: regular shell command. For example:</p>
<pre><code>steps:
  - run: mkdir folder
</code></pre></li>
<li><p><strong>Script</strong>: you can define shell, python or Ruby scripts in the <code>scripts/</code> folder, making it convenient to reuse commands across multiple tasks or simply isolate a complex set of commands. For example:</p>
<pre><code>steps:
  - run: devops scripts/some_script.sh
</code></pre><p>  <em>To use packages (<code>pip</code> or <code>gems</code>) we recommend you use the configuration of respectively the <a href="/services/python">Python</a> or <a href="/services/ruby">Ruby</a> services rather than installing them from within a script.</em></p>
</li>
<li><p><strong>devops command</strong>: services installed on your nodes usually come with some helper commands. A devops command looks like <code>devops {SERVICE} {COMMAND}</code> where <code>{SERVICE}</code> is the name of the service and <code>{COMMAND}</code> the name of the specific command. Some of these commands require you to define options. For example, cloning or updating a git repository can be done as follow:</p>
<pre><code>steps:
  - run: devops git update
    options:
      repo: https://github.com/user/repo.git
      dest: /some/local/folder
      version: master
</code></pre><p>  <em>As for the scripts, we use the <code>devops</code> keyword. Services documentations list the devops commands available for each service. See for example <a href="/services/git#commands">Git list of commands</a>.</em></p>
</li>
</ul>
<p>Commands are run as the <code>devops</code> user on targeted nodes. You can however switch users by using the <code>sudo</code> command in scripts or inline commands.</p>
<h2 id="triggers">Triggers</h2>
<p>Tasks are run whenever one of the triggers conditions are met.</p>
<p><em>We currently only support manual and webhook triggers. We are working on adding support for cron and 3rd party events (GitHub, TravisCI, NewRelic...). Webhooks are however flexible enough that you should be able to integrate most 3rd parties already.</em></p>
<h3 id="webhook">Webhook</h3>
<p>Webhooks allow you define HTTP callbacks which you, or a 3rd party, can query with a <code>POST</code> payload.</p>
<p>The following definition in a task:</p>
<pre><code>triggers:
  webhooks:
    - path: some/secret/url
    - path: some/other/url
</code></pre><p><em>While we are considering more security measures, like restricting access to webhooks for user defined IPs, we recommend that you use obfuscted/complex URLs for your webhooks (if you wish to keep it private).</em></p>
<p>Will automatically create the following endpoints:</p>
<pre><code>https://wh.devo.ps/{USER}/{REPO}/some/secret/url
https://wh.devo.ps/{USER}/{REPO}/some/other/url
</code></pre><p>Where <code>{USER}</code> is the repository owner and <code>{REPO}</code> the name of the repository.</p>
<p>When a webhook receives a <code>POST</code> payload, it gets converted a JSON object and assigned to the <code>{{ payload }}</code> <a href="/manual/variables">variable</a>.</p>

</section>




    </section>
  <section>

  <!-- JS -->
  <!-- <script src='/assets/scripts.js' type='text/javascript'></script> -->
  <script src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.0/highlight.min.js' type='text/javascript'></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <!--[if lt IE 9]><script src='http://html5shim.googlecode.com/svn/trunk/html5.js'></script><![endif]-->
  <script type='text/javascript'>
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '510b396a613f5d2666000007');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
  <script type='text/javascript'>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34006371-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
